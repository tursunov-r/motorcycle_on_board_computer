# Проект бортового компьютера

Этот репозиторий содержит прошивку и конфигурацию для кастомного бортового компьютера, построенного на базе ESP32-S3 под управлением microPython.  
Он основан на плате LilyGo T-Display-S3 с дисплеем ST7789 (170x320)

## Возможности
- Кастомная прошивка для ESP32-S3  
- Конфигурация драйвера дисплея ST7789  
- Измерения уровня топлива
- Расчет оставшегося топлива в баке на оставшееся расстояние (показания примерные и не являются истинными, так как зависят от датчика уровня топлива в баке и точность показаний зависит от точности сопротивления датчика топлива)
- Напряжение бортовой сети
- Температура и влажность воздуха
- Суточный пробег
- Часы реального времени
- Индикатор включенной передачи
- Автоматическая регулировка подсветки в зависимости от уровня освещённости  
- Модульная структура кода для удобного расширения  

## Авторы
- **Ruslan Tursunov (2025)** – основной разработчик данного проекта бортового компьютера  
- **Russ Hughes (2020–2022)** – автор библиотеки `s3lcd` и примеров конфигурации дисплея  
- **Ivan Belokobylskiy (2019)** – оригинальный автор конфигурационного кода, включённого в `s3lcd`  

## Лицензия
Проект распространяется под лицензией [MIT License](LICENSE).  
Все оригинальные уведомления об авторских правах сохранены.

## Установка прошивки
Для начала необходимо установить [Python](https://www.python.org/)
- Используйте виртуальное окружение для установки инструментов
```
python3 -m venv .venv
source .venv/bin/activate
```
- Установите esptool
```
pip install esptool
```
- Проверьте к какому порту подключен микроконтроллер
```
ls /dev/cu.*
```
Пример ответа:
```
/dev/cu.usbmodem1101
```
- Установите прошивку через esptool
```
esptool.py --port /dev/tty.<your_com_port> erase_flash
esptool.py --chip ESP32-S3- --port /dev/tty.<your_com_port> write_flash -z 0x1000 firmware/firmware.bin
```
- Загрузите содержимое папки [main](main) в память микроконтроллера

## Настроить параметры
Параметры:
- Колеса для скорости и расчета оставшегося топлива в баке
- Объем полного бака
- Расход по трассе
- Расход по городу
Указывается в соответствующих переменных в файле [handlers.py](main/functions/handlers.py)

## Компоненты
- Lilygo T-Display-S3
- DS3231
- DHT11
- Резистор 1кОм x2
- Резистор 100кОм
- Резистор 27кОм
- Фоторезистор
- Понижающий модуль питания с 12-15 вольт до 5 вольт

## Схема подключения
![schema](schemas/schema.png)

## Целевое применение
Данный проект был разработан для мотоцикла CFMOTO TK650
В данный момент не был установлен и протестирован

## Благодарности
Особая благодарность:
- **[Russ Hughes](https://github.com/russhughes)** за его отличную библиотеку [s3lcd](https://github.com/russhughes/s3lcd), которая стала основой для работы с дисплеем.  
- **[Ivan Belokobylskiy](https://github.com/devbis)** за оригинальную конфигурацию, сделавшую драйверы дисплеев для ESP32 более доступными.  

Без их вклада этот проект не был бы возможен.